<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Crédito - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="assets/css/main.css" rel="stylesheet">
    <script src="https://unpkg.com/framer-motion@10.12.16/dist/framer-motion.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50">
    <div id="cpf-entry" class="flex flex-col items-center justify-center min-h-screen p-6">
        <div class="w-full max-w-md">
            <div class="text-center mb-10">
                <div class="inline-block p-3 rounded-full bg-blue-600 text-white mb-4">
                    <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Análise de Crédito</h1>
                <p class="text-gray-600">Informe o CPF para começarmos</p>
            </div>

            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                <div class="p-8">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2" for="cpf">
                            CPF do Cliente
                        </label>
                        <input
                            type="text"
                            id="cpf"
                            placeholder="000.000.000-00"
                            maxlength="14"
                            class="w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg transition-all"
                        >
                    </div>

                    <button
                        id="fetch-data-btn"
                        class="w-full py-3 px-4 rounded-lg text-white font-medium text-lg transition-all bg-gray-400 cursor-not-allowed"
                        disabled
                    >
                        Consultar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-5 rounded-lg flex items-center">
            <svg class="animate-spin h-5 w-5 text-blue-600 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Consultando dados...</span>
        </div>
    </div>

    <script src="assets/js/cpf-validator.js"></script>
    <script src="assets/js/integration.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cpfInput = document.getElementById('cpf');
            const fetchButton = document.getElementById('fetch-data-btn');
            
            // Aplicar máscara de CPF
            cpfInput.addEventListener('input', function() {
                this.value = formatCPF(this.value);
                
                // Habilitar botão apenas se CPF for válido
                if (isValidCPF(this.value)) {
                    fetchButton.disabled = false;
                    fetchButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    fetchButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
                } else {
                    fetchButton.disabled = true;
                    fetchButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                    fetchButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                }
            });
            
            // Configurar botão para buscar dados
            fetchButton.addEventListener('click', function() {
                const cpf = cpfInput.value;
                if (!isValidCPF(cpf)) return;
                
                document.getElementById('loading').classList.remove('hidden');
                
                // Simular busca de dados (em produção, conectaria ao webhook do Ploomes)
                fetchCustomerData(cpf)
                    .then(data => {
                        // Armazenar dados no localStorage para uso na página de dashboard
                        localStorage.setItem('customerData', JSON.stringify(data));
                        localStorage.setItem('customerCPF', cpf);
                        
                        // Redirecionar para o dashboard
                        window.location.href = 'dashboard.html';
                    })
                    .catch(error => {
                        console.error('Erro ao buscar dados:', error);
                        alert('Erro ao buscar dados do cliente. Por favor, tente novamente.');
                        document.getElementById('loading').classList.add('hidden');
                    });
            });
        });
    </script>
</body>
</html>
