<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Análise de Crédito | Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
        }
        .input-focus-effect:focus {
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3);
        }
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .shimmer {
            background: linear-gradient(90deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.2) 50%, 
                rgba(255,255,255,0) 100%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            to { background-position: -200% 0; }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50">
    <div id="cpf-entry" class="flex flex-col items-center justify-center min-h-screen p-6">
        <div class="w-full max-w-md">
            <!-- Logo e título -->
            <div class="text-center mb-8">
                <div class="inline-block p-4 rounded-full gradient-bg text-white mb-5 shadow-lg animate-float">
                    <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold text-gray-800 mb-2">Análise de Crédito</h1>
                <p class="text-gray-600 text-lg">Informe o CPF para começarmos</p>
            </div>

            <!-- Card principal -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden transform transition-all hover:shadow-2xl">
                <div class="p-8">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2" for="cpf">
                            CPF do Cliente
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="cpf"
                                placeholder="000.000.000-00"
                                maxlength="14"
                                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:border-indigo-500 text-lg transition-all input-focus-effect"
                                autocomplete="off"
                            >
                            <div id="cpf-status" class="hidden absolute right-3 top-1/2 transform -translate-y-1/2 text-green-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                            </div>
                        </div>
                        <p id="cpf-error" class="hidden text-xs text-red-500 mt-1">CPF inválido</p>
                    </div>

                    <button
                        id="fetch-data-btn"
                        class="w-full py-3 px-4 rounded-lg text-white font-medium text-lg transition-all gradient-bg hover:opacity-90 transform hover:-translate-y-0.5"
                    >
                        Consultar
                    </button>
                </div>
            </div>
            
            <!-- Mensagem informativa -->
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-500">
                    Sistema seguro de análise de crédito
                    <span class="block mt-1">© 2025 SuaEmpresa</span>
                </p>
            </div>
        </div>
    </div>

    <!-- Overlay de carregamento -->
    <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white p-6 rounded-lg flex flex-col items-center shadow-2xl max-w-sm w-full mx-4">
            <div class="shimmer w-full h-full absolute inset-0 rounded-lg"></div>
            <div class="relative z-10">
                <div class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                <p class="text-lg font-medium text-gray-700">Consultando dados...</p>
                <p class="text-sm text-gray-500 mt-2">Isso pode levar alguns instantes</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/cpf-validator.js"></script>
    <script src="assets/js/integration.js"></script>
    <script>
        // Função para sempre habilitar o botão, independentemente da validação
        function alwaysEnableButton() {
            const fetchButton = document.getElementById('fetch-data-btn');
            if (fetchButton) {
                fetchButton.disabled = false;
            }
        }

        // Garantimos que o botão esteja sempre habilitado
        alwaysEnableButton();
        
        // Garantimos que o botão seja reabilitado caso algo o desabilite
        setInterval(alwaysEnableButton, 500);

        // Quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', function() {
            const cpfInput = document.getElementById('cpf');
            const fetchButton = document.getElementById('fetch-data-btn');
            const cpfStatus = document.getElementById('cpf-status');
            const cpfError = document.getElementById('cpf-error');
            
            // Garantimos novamente que o botão esteja habilitado
            alwaysEnableButton();
            
            // Função para formatar CPF (fallback caso cpf-validator.js falhe)
            function formatCPFSafe(value) {
                try {
                    // Tenta usar a função global do cpf-validator.js
                    if (typeof formatCPF === 'function') {
                        return formatCPF(value);
                    }
                    
                    // Fallback: implementação básica de formatação
                    const digits = value.replace(/\D/g, '');
                    if (digits.length <= 3) return digits;
                    if (digits.length <= 6) return `${digits.slice(0, 3)}.${digits.slice(3)}`;
                    if (digits.length <= 9) return `${digits.slice(0, 3)}.${digits.slice(3, 6)}.${digits.slice(6)}`;
                    return `${digits.slice(0, 3)}.${digits.slice(3, 6)}.${digits.slice(6, 9)}-${digits.slice(9, 11)}`;
                } catch (e) {
                    console.error('Erro na formatação de CPF:', e);
                    return value; // Retorna o valor original em caso de erro
                }
            }
            
            // Função para validar CPF (fallback caso cpf-validator.js falhe)
            function isValidCPFSafe(value) {
                try {
                    // Tenta usar a função global do cpf-validator.js
                    if (typeof isValidCPF === 'function') {
                        return isValidCPF(value);
                    }
                    
                    // Se a função não existir, aceita qualquer CPF com 11 dígitos
                    const digits = value.replace(/\D/g, '');
                    return digits.length === 11;
                } catch (e) {
                    console.error('Erro na validação de CPF:', e);
                    return true; // Assume válido em caso de erro
                }
            }
            
            // Aplicar máscara e validação ao CPF
            cpfInput.addEventListener('input', function() {
                this.value = formatCPFSafe(this.value);
                
                // Validação visual do CPF (apenas para feedback, não bloqueia o botão)
                const isValid = isValidCPFSafe(this.value);
                
                if (this.value.length > 0) {
                    if (isValid) {
                        cpfStatus.classList.remove('hidden');
                        cpfError.classList.add('hidden');
                        this.classList.add('border-green-500');
                        this.classList.remove('border-red-500');
                    } else {
                        cpfStatus.classList.add('hidden');
                        cpfError.classList.remove('hidden');
                        this.classList.add('border-red-500');
                        this.classList.remove('border-green-500');
                    }
                } else {
                    cpfStatus.classList.add('hidden');
                    cpfError.classList.add('hidden');
                    this.classList.remove('border-green-500', 'border-red-500');
                }
                
                // Não mexemos no estado do botão - ele sempre fica habilitado
            });
            
            // Configurar botão para buscar dados
            fetchButton.addEventListener('click', function() {
                const cpf = cpfInput.value;
                
                // Verifica se o CPF está preenchido
                if (!cpf || cpf.replace(/\D/g, '').length < 11) {
                    cpfError.textContent = 'Por favor, digite um CPF completo';
                    cpfError.classList.remove('hidden');
                    cpfInput.classList.add('border-red-500');
                    return;
                }
                
                document.getElementById('loading').classList.remove('hidden');
                
                // Função para buscar dados de cliente (fallback caso integration.js falhe)
                function fetchCustomerDataSafe(cpf) {
                    // Tenta usar a função do integration.js
                    if (typeof fetchCustomerData === 'function') {
                        return fetchCustomerData(cpf);
                    }
                    
                    // Fallback: uma promessa que simula o comportamento
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            // Dados mockados para caso a função real não exista
                            const mockData = {
                                personal: {
                                    proponentes: [
                                        {
                                            nome: 'Cliente Exemplo',
                                            cpf: cpf,
                                            email: 'cliente@exemplo.com'
                                        }
                                    ]
                                }
                            };
                            resolve(mockData);
                        }, 1500);
                    });
                }
                
                // Busca os dados
                fetchCustomerDataSafe(cpf)
                    .then(data => {
                        // Armazenar dados no localStorage para uso na página de dashboard
                        localStorage.setItem('customerData', JSON.stringify(data));
                        localStorage.setItem('customerCPF', cpf);
                        
                        // Redirecionar para o dashboard
                        window.location.href = 'dashboard.html';
                    })
                    .catch(error => {
                        console.error('Erro ao buscar dados:', error);
                        alert('Erro ao buscar dados do cliente. Por favor, tente novamente.');
                        document.getElementById('loading').classList.add('hidden');
                    });
            });
        });
    </script>
</body>
</html>
